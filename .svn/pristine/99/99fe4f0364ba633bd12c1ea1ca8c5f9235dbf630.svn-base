/*
 * simcom.h
 *
 *  Created on: Aug 14, 2019
 *      Author: Puja
 */

#ifndef SIMCOM_H_
#define SIMCOM_H_

#include "main.h"
#include "cmsis_os.h"

#include <stdio.h>							// for: sprintf()
#include <string.h>							// for: memset()
#include <stdlib.h>							// for: itoa()
#include "_config.h"
#include "_nmea.h"
#include "_eeprom.h"
#include "_DMA_Simcom.h"

#define SIMCOM_CMD_TIMEOUT						5 			// in second

#define SIMCOM_STATUS_SEND 					"\r\n>"
#define SIMCOM_STATUS_CIPSEND				"\r\n+CIPSEND:"
#define SIMCOM_STATUS_OK 						"OK\r\n"
#define SIMCOM_STATUS_ERROR 				"ERROR\r\n"
#define SIMCOM_STATUS_READY 				"PB DONE\r\n"
#define SIMCOM_STATUS_RESTARTED			"START\r\n"

#define SIMCOM_MESSAGE_END					"\x1A"

#define SIMCOM_POS_HEADER_LENGTH		31
#define SIMCOM_POS_DATA_LENGTH			663

#define SIMCOM_MESSAGE_LENGTH				500

/* Public typedef -----------------------------------------------------------*/
typedef struct {
	char var[20];
	char val[20];
	char cmd[40];
} command_t;

/* Public functions ---------------------------------------------------------*/
void Ublox_Init(gps_t *hgps);
void Simcom_Init(uint8_t restart);
void Simcom_Set_Message(char* msg);
void Simcom_Convert_GPS(gps_t *hgps);
void Simcom_Set_Payload(void);
uint8_t Simcom_Send_Payload(void);
uint8_t Simcom_Check_Command(void);
uint8_t Simcom_Get_Command(command_t *command);
uint8_t Simcom_To_Server(char *message, uint16_t length);
void Simcom_Set_Odometer(uint32_t odom);

#endif /* SIMCOM_H_ */
